<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StockFlow ‚Äî Inventory & GST Billing</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<style>
:root{--bg:#0d0f14;--surface:#161b24;--surface2:#1e2535;--border:#2a3347;--accent:#00e5a0;--accent2:#ff6b35;--warn:#ffd166;--danger:#ff4757;--blue:#5eb8ff;--green:#34a853;--text:#e8edf5;--muted:#7a8ba0;--radius:10px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;font-size:14px}

/* TOPBAR */
.topbar{display:flex;align-items:center;justify-content:space-between;padding:13px 24px;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100;flex-wrap:wrap;gap:8px}
.logo{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;letter-spacing:-.5px}
.logo span{color:var(--accent)}
.logo-badge{background:color-mix(in srgb,var(--green) 15%,transparent);border:1px solid color-mix(in srgb,var(--green) 35%,transparent);color:var(--green);font-size:10px;padding:2px 8px;border-radius:99px;font-weight:600;letter-spacing:.3px;margin-left:8px;vertical-align:middle}
.tabs{display:flex;gap:3px;background:var(--bg);border-radius:8px;padding:3px;flex-wrap:wrap}
.tab{padding:6px 14px;border-radius:6px;cursor:pointer;font-size:12px;font-weight:500;color:var(--muted);border:none;background:none;transition:all .2s;white-space:nowrap}
.tab.active{background:var(--surface2);color:var(--text)}
.tab:hover:not(.active){color:var(--text)}
.topbar-right{display:flex;gap:8px;align-items:center}
.btn{padding:7px 14px;border-radius:8px;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;transition:all .15s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:var(--accent);color:#000}
.btn-primary:hover{filter:brightness(1.1);transform:translateY(-1px)}
.btn-ghost{background:var(--surface2);color:var(--text);border:1px solid var(--border)}
.btn-ghost:hover{background:var(--border)}
.btn-green{background:var(--green);color:#fff}
.btn-green:hover{filter:brightness(1.1)}
.btn-sm{padding:5px 11px;font-size:12px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}

/* SYNC STATUS BAR */
.sync-bar{background:var(--surface2);border-bottom:1px solid var(--border);padding:7px 26px;display:flex;align-items:center;gap:12px;font-size:12px;color:var(--muted)}
.sync-dot{width:8px;height:8px;border-radius:50%;background:var(--muted);flex-shrink:0}
.sync-dot.connected{background:var(--green);box-shadow:0 0 6px var(--green)}
.sync-dot.syncing{background:var(--warn);animation:pulse 1s infinite}
.sync-dot.error{background:var(--danger)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
.sync-text{flex:1}
.sync-actions{display:flex;gap:8px;margin-left:auto}

/* MAIN & STATS */
.main{padding:20px 24px;max-width:1440px;margin:0 auto}
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:11px;margin-bottom:20px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:15px 17px;position:relative;overflow:hidden}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent-color,var(--accent))}
.stat-label{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.stat-value{font-family:'Syne',sans-serif;font-size:22px;font-weight:700}
.stat-sub{color:var(--muted);font-size:11px;margin-top:3px}

/* SETUP BANNER */
.setup-banner{background:linear-gradient(135deg,#0d1a14,#0d1424);border:1px solid color-mix(in srgb,var(--green) 30%,transparent);border-radius:12px;padding:28px;margin-bottom:22px}
.setup-banner h2{font-family:'Syne',sans-serif;font-size:20px;font-weight:700;margin-bottom:6px}
.setup-banner h2 span{color:var(--green)}
.setup-banner p{color:var(--muted);font-size:13px;margin-bottom:18px;max-width:600px}
.setup-steps{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px}
.setup-step{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px}
.setup-step-num{width:28px;height:28px;border-radius:50%;background:var(--green);color:#fff;font-size:13px;font-weight:700;display:flex;align-items:center;justify-content:center;margin-bottom:10px}
.setup-step-title{font-weight:600;font-size:13px;margin-bottom:5px}
.setup-step-desc{font-size:12px;color:var(--muted);line-height:1.6}
.setup-input-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.setup-input{flex:1;min-width:280px;padding:10px 14px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;outline:none;transition:border-color .2s}
.setup-input:focus{border-color:var(--green)}

/* TOOLBAR & TABLE */
.toolbar{display:flex;gap:8px;margin-bottom:14px;align-items:center;flex-wrap:wrap}
.search-wrap{position:relative;flex:1;max-width:290px}
.search-wrap input{width:100%;padding:8px 13px 8px 34px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border-color .2s}
.search-wrap input:focus{border-color:var(--accent)}
.search-icon{position:absolute;left:11px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:12px}
select{padding:8px 11px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;cursor:pointer}
.toolbar-right{margin-left:auto;display:flex;gap:7px}
.table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
table{width:100%;border-collapse:collapse}
thead th{padding:10px 13px;text-align:left;font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);font-weight:500;background:var(--surface2);border-bottom:1px solid var(--border);cursor:pointer;user-select:none}
tbody tr{border-bottom:1px solid var(--border);transition:background .1s}
tbody tr:hover{background:var(--surface2)}
tbody td{padding:10px 13px;vertical-align:middle}
.item-name{font-weight:500;font-size:13px}
.item-sku{color:var(--muted);font-family:'DM Mono',monospace;font-size:11px}
.item-barcode{color:#3a4d66;font-family:'DM Mono',monospace;font-size:10px;letter-spacing:1.5px}
.badge{display:inline-block;padding:2px 9px;border-radius:99px;font-size:11px;font-weight:500}
.badge-retail{background:#1a3a5e;color:#5eb8ff}
.badge-warehouse{background:#2d2a14;color:#ffd166}
.badge-mfg{background:#1a3a2a;color:#00e5a0}
.stock-bar-wrap{display:flex;align-items:center;gap:7px}
.stock-bar{flex:1;height:4px;background:var(--border);border-radius:99px;max-width:65px}
.stock-fill{height:100%;border-radius:99px;transition:width .3s}
.stock-num{font-family:'DM Mono',monospace;font-size:12px;min-width:30px;text-align:right}
.actions{display:flex;gap:5px}
.icon-btn{background:none;border:1px solid var(--border);border-radius:6px;color:var(--muted);cursor:pointer;padding:4px 7px;font-size:12px;transition:all .15s}
.icon-btn:hover{border-color:var(--accent);color:var(--accent)}
.icon-btn.del:hover{border-color:var(--danger);color:var(--danger)}
.pager{display:flex;align-items:center;justify-content:space-between;padding:11px 13px;border-top:1px solid var(--border)}
.pager-info{color:var(--muted);font-size:12px}

/* MODALS */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:200;display:none;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;width:560px;max-width:96vw;max-height:92vh;overflow-y:auto;animation:modalIn .2s ease}
@keyframes modalIn{from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1}}
.modal-title{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;margin-bottom:16px}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:11px}
.form-group{display:flex;flex-direction:column;gap:4px}
.form-group.full{grid-column:1/-1}
label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
.form-input{padding:8px 11px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none}
.form-input:focus{border-color:var(--accent)}
.modal-actions{display:flex;gap:8px;justify-content:flex-end;margin-top:18px}

/* SHEETS SETUP MODAL */
.sheets-modal{width:680px}
.code-block{background:#070a0e;border:1px solid var(--border);border-radius:8px;padding:14px;font-family:'DM Mono',monospace;font-size:12px;line-height:1.8;overflow-x:auto;color:#cce;margin:10px 0;max-height:300px;overflow-y:auto;}
.code-block .kw{color:var(--accent)}.code-block .str{color:var(--warn)}.code-block .cm{color:#3d5c3d}
.step-pill{display:inline-block;width:22px;height:22px;border-radius:50%;background:var(--green);color:#fff;font-size:11px;font-weight:700;text-align:center;line-height:22px;margin-right:7px;flex-shrink:0}
.instruction-row{display:flex;gap:10px;align-items:flex-start;padding:10px 0;border-bottom:1px solid var(--border);font-size:13px}
.instruction-row:last-child{border-bottom:none}
.instruction-text{flex:1;color:var(--muted);line-height:1.6}
.instruction-text strong{color:var(--text)}

/* OTHER TABS */
.section-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:13px}
.section-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700}
.cards-grid{display:grid;grid-template-columns:1fr 1fr;gap:13px;margin-bottom:18px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px}
.card-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:12px;color:var(--accent)}
.card-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)}
.card-label{color:var(--muted);font-size:12px}
.card-val{font-family:'DM Mono',monospace;font-size:13px;font-weight:500}
.alert-item{display:flex;align-items:center;gap:11px;padding:9px 13px;border-radius:8px;margin-bottom:7px}
.alert-warn{background:color-mix(in srgb,var(--warn) 8%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent)}
.alert-crit{background:color-mix(in srgb,var(--danger) 8%,transparent);border:1px solid color-mix(in srgb,var(--danger) 25%,transparent)}
.alert-text{flex:1;font-size:13px}
.alert-action{font-size:12px;color:var(--accent);cursor:pointer;text-decoration:underline}
.empty{text-align:center;padding:44px 20px;color:var(--muted)}
.empty-icon{font-size:32px;margin-bottom:8px}

/* LOADERS & TOASTS */
.toast{position:fixed;bottom:22px;right:22px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px 17px;font-size:13px;z-index:300;display:flex;align-items:center;gap:9px;transform:translateY(70px);opacity:0;transition:all .3s;pointer-events:none}
.toast.show{transform:translateY(0);opacity:1}
.loading-overlay{position:fixed;inset:0;background:rgba(13,15,20,.85);z-index:500;display:none;align-items:center;justify-content:center;flex-direction:column;gap:14px}
.loading-overlay.show{display:flex}
.spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* SUPPLIERS */
.sup-table{width:100%;border-collapse:collapse}
.sup-table th,.sup-table td{padding:9px 13px;border-bottom:1px solid var(--border);font-size:13px}
.sup-table th{color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:.4px;background:var(--surface2)}

/* CHARTS & IMPORT */
.chart-wrap{position:relative;height:190px;margin-top:8px}
.import-area{border:2px dashed var(--border);border-radius:10px;padding:22px;text-align:center;cursor:pointer;transition:border-color .2s;margin-bottom:11px}
.import-area:hover{border-color:var(--accent)}
.import-area input{display:none}

/* GST BILL (Condensed) */
#tab-gst{font-family:'DM Sans',sans-serif}
.gst-layout{display:grid;grid-template-columns:1fr 390px;gap:18px;align-items:start}
.gst-builder{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px}
.gst-preview-wrap{position:sticky;top:74px}
.gst-preview{background:#fff;color:#111;border-radius:10px;overflow:hidden;font-family:'DM Sans',sans-serif;font-size:12px}
.bill-header{background:#12192a;color:#fff;padding:20px 22px}
.bill-company{font-size:17px;font-weight:700;margin-bottom:2px;color:#00e5a0;font-family:'Syne',sans-serif}
.bill-meta{display:grid;grid-template-columns:1fr 1fr;gap:3px;font-size:11px;color:#bbb}
.bill-section{padding:14px 20px;border-bottom:1px solid #eee}
.bill-items-table{width:100%;border-collapse:collapse;font-size:11px}
.bill-items-table th{background:#f5f7fa;padding:7px 9px;text-align:left;font-size:9px;text-transform:uppercase;color:#777;border-bottom:1px solid #e0e0e0}
.bill-items-table td{padding:7px 9px;border-bottom:1px solid #f2f2f2;vertical-align:top}
.bill-totals{padding:14px 20px;background:#f9fafb}
.bill-total-row{display:flex;justify-content:space-between;font-size:11px;padding:2px 0;color:#555}
.bill-total-row.grand{font-size:13px;font-weight:700;color:#111;border-top:2px solid #111;margin-top:5px;padding-top:7px}
.gst-section{background:var(--surface2);border-radius:8px;padding:14px;margin-bottom:12px}
.gst-section-title{font-size:11px;font-weight:600;color:var(--accent);text-transform:uppercase;margin-bottom:10px}
.gst-form-row{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:9px}
.gst-label{font-size:11px;color:var(--muted);margin-bottom:3px}
.gst-item-row{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 32px;gap:5px;margin-bottom:6px;align-items:end}
.rm-btn{background:var(--danger);color:#fff;border:none;border-radius:6px;cursor:pointer;padding:8px 7px;font-size:12px}
@media print{ .topbar,.main>div:not(#tab-gst),.gst-builder,.sync-bar{display:none!important} .gst-layout{display:block!important} .gst-preview-wrap{position:static} .gst-preview{border-radius:0} body{background:#fff} }
.hidden{display:none!important}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:99px}
kbd{background:var(--surface2);border:1px solid var(--border);border-radius:4px;padding:1px 6px;font-family:'DM Mono',monospace;font-size:11px}

/* BARCODE SCAN TABS */
.scan-tab-wrap{max-width:680px;margin:0 auto}
.scan-mode-toggle{display:flex;gap:0;background:var(--surface2);border-radius:10px;padding:4px;margin-bottom:20px;border:1px solid var(--border)}
.scan-mode-btn{flex:1;padding:10px 16px;border-radius:7px;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;transition:all .2s;color:var(--muted);background:none}
.scan-mode-btn.active{color:#fff}
.scan-mode-btn.add.active{background:var(--green)}
.scan-mode-btn.deduct.active{background:var(--danger)}
.scan-hero{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:28px;margin-bottom:16px}
.scan-hero-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;margin-bottom:6px}
.scan-input-row{display:flex;gap:9px;margin-bottom:14px;align-items:flex-end}
.scan-barcode-input{flex:1;padding:13px 16px;background:var(--bg);border:2px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Mono',monospace;font-size:16px;letter-spacing:2px;outline:none;transition:border-color .2s}
.scan-barcode-input:focus{border-color:var(--accent)}
.scan-barcode-input.add-mode:focus{border-color:var(--green)}
.scan-barcode-input.deduct-mode:focus{border-color:var(--danger)}
.qty-input-wrap{display:flex;flex-direction:column;gap:4px}
.qty-input-wrap label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px}
.qty-input{width:90px;padding:13px 12px;background:var(--bg);border:2px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Mono',monospace;font-size:16px;text-align:center;outline:none;transition:border-color .2s}
.qty-input:focus{border-color:var(--accent)}
.scan-result-card{background:var(--surface2);border-radius:12px;padding:20px;margin-bottom:14px;border:1px solid var(--border);display:none}
.scan-result-card.show{display:block}
.scan-result-card.add-result{border-color:color-mix(in srgb,var(--green) 40%,transparent);background:color-mix(in srgb,var(--green) 6%,var(--surface2))}
.scan-result-card.deduct-result{border-color:color-mix(in srgb,var(--danger) 40%,transparent);background:color-mix(in srgb,var(--danger) 6%,var(--surface2))}
.scan-result-name{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;margin-bottom:3px}
.scan-result-sku{font-family:'DM Mono',monospace;font-size:12px;color:var(--muted);margin-bottom:12px}
.scan-stock-change{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
.scan-stock-box{background:var(--bg);border:1px solid var(--border);border-radius:9px;padding:10px 18px;text-align:center}
.scan-stock-box .lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:3px}
.scan-stock-box .val{font-family:'Syne',sans-serif;font-size:22px;font-weight:700}
.scan-arrow{font-size:22px;color:var(--muted)}
.scan-history{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px}
.scan-history-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;margin-bottom:13px;color:var(--muted)}
.scan-hist-item{display:flex;align-items:center;gap:11px;padding:9px 0;border-bottom:1px solid var(--border);font-size:13px}
.scan-hist-item:last-child{border-bottom:none}
.scan-hist-badge{font-size:11px;font-weight:700;padding:3px 9px;border-radius:99px;flex-shrink:0}
.scan-hist-add{background:color-mix(in srgb,var(--green) 15%,transparent);color:var(--green)}
.scan-hist-deduct{background:color-mix(in srgb,var(--danger) 15%,transparent);color:var(--danger)}
.scan-hist-info{flex:1}
.scan-hist-time{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;flex-shrink:0}
.not-found-card{background:color-mix(in srgb,var(--warn) 8%,var(--surface2));border:1px solid color-mix(in srgb,var(--warn) 35%,transparent);border-radius:12px;padding:18px;text-align:center;display:none}
.not-found-card.show{display:block}
.scan-cam-btn{white-space:nowrap;border-color:var(--accent)!important;color:var(--accent)!important}
.reader-scan{width:100%;margin-top:12px;display:none;border-radius:8px;overflow:hidden;border:1px solid var(--border)}

/* ===== STOCK MONITOR FLOWCHART ===== */
.monitor-layout{display:grid;grid-template-columns:1fr 340px;gap:16px;align-items:start}
.monitor-flow{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;overflow-x:auto}
.monitor-sidebar{display:flex;flex-direction:column;gap:12px}
.flow-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;margin-bottom:18px;display:flex;align-items:center;gap:8px}
.flow-canvas{position:relative;min-height:580px;min-width:560px}
/* flow nodes */
.fn{position:absolute;border-radius:10px;padding:10px 16px;font-size:12px;font-weight:600;text-align:center;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:3px;box-shadow:0 2px 12px rgba(0,0,0,.35);cursor:default;transition:transform .2s,box-shadow .2s;z-index:2}
.fn:hover{transform:translateY(-2px);box-shadow:0 6px 22px rgba(0,0,0,.5)}
.fn-start{background:linear-gradient(135deg,#00e5a0,#00b87a);color:#000;border-radius:50px;width:130px}
.fn-process{background:var(--surface2);border:1.5px solid var(--border);color:var(--text);width:155px}
.fn-decision{background:linear-gradient(135deg,#1e2535,#2a3347);border:2px solid var(--warn);color:var(--warn);width:160px;border-radius:8px;transform:rotate(0deg)}
.fn-action-green{background:linear-gradient(135deg,#0d3322,#1a5c3a);border:1.5px solid var(--green);color:var(--green);width:155px}
.fn-action-red{background:linear-gradient(135deg,#2d0d14,#5c1a24);border:1.5px solid var(--danger);color:var(--danger);width:155px}
.fn-action-blue{background:linear-gradient(135deg,#0d1a2d,#1a3a5c);border:1.5px solid var(--blue);color:var(--blue);width:155px}
.fn-action-yellow{background:linear-gradient(135deg,#2d2400,#5c4a00);border:1.5px solid var(--warn);color:var(--warn);width:155px}
.fn-end{background:linear-gradient(135deg,#ff4757,#c0392b);color:#fff;border-radius:50px;width:130px}
.fn-label{font-size:10px;color:var(--muted);font-weight:400;margin-top:1px}
.fn-live{font-family:'DM Mono',monospace;font-size:13px;font-weight:700}
/* SVG arrows */
.flow-svg{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}
.flow-svg path,.flow-svg line{stroke:var(--border);stroke-width:1.8;fill:none;marker-end:url(#arrowhead)}
.flow-svg text{fill:var(--muted);font-size:10px;font-family:'DM Sans',sans-serif}
/* monitor sidebar cards */
.mon-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px}
.mon-card-title{font-size:11px;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);margin-bottom:11px;font-weight:600}
.mon-item{display:flex;align-items:center;gap:9px;padding:7px 0;border-bottom:1px solid var(--border);font-size:12px}
.mon-item:last-child{border-bottom:none}
.mon-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.mon-name{flex:1;font-weight:500}
.mon-stock{font-family:'DM Mono',monospace;font-size:12px}
.algo-step{display:flex;gap:9px;padding:8px 0;border-bottom:1px solid var(--border);align-items:flex-start;font-size:12px}
.algo-step:last-child{border-bottom:none}
.algo-num{width:20px;height:20px;border-radius:50%;background:var(--surface2);color:var(--accent);font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px}
.pulse-ring{animation:pulseRing 2s infinite}
@keyframes pulseRing{0%,100%{opacity:1}50%{opacity:.4}}

/* ===== VARIANTS ‚Äî 3-PANEL LAYOUT ===== */
.var-page{display:grid;grid-template-columns:230px 1fr 260px;height:calc(100vh - 62px);overflow:hidden;margin:-20px -24px}
.var-sidebar{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.var-main{overflow-y:auto;background:var(--bg);padding:16px;display:flex;flex-direction:column}
.var-notif-rail{background:var(--surface);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
/* Slide-out form drawer */
.var-drawer{position:fixed;top:0;right:0;width:460px;height:100vh;background:var(--surface);border-left:2px solid var(--border);z-index:200;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);box-shadow:-12px 0 40px rgba(0,0,0,.5)}
.var-drawer.open{transform:translateX(0)}
.var-drawer-hd{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.var-drawer-bd{overflow-y:auto;flex:1;padding:18px 20px}
.var-drawer-ft{padding:12px 20px;border-top:1px solid var(--border);display:flex;gap:8px;flex-shrink:0}
.var-scrim{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:199;opacity:0;pointer-events:none;transition:opacity .28s}
.var-scrim.show{opacity:1;pointer-events:all}
/* Sidebar */
.var-sb-hd{padding:12px 14px;border-bottom:1px solid var(--border);flex-shrink:0}
.var-sb-body{overflow-y:auto;flex:1;padding:6px}
.var-idx-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;cursor:pointer;transition:background .12s;border-left:2px solid transparent}
.var-idx-item:hover{background:var(--surface2)}
.var-idx-item.active{background:color-mix(in srgb,var(--accent) 8%,transparent);border-left-color:var(--accent)}
.var-idx-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
/* Main area */
.var-topbar{display:flex;gap:8px;margin-bottom:12px;align-items:center}
.var-search{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:8px 12px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none}
.var-search:focus{border-color:var(--accent)}
.var-fchip{padding:6px 12px;border-radius:99px;border:1px solid var(--border);background:var(--surface);color:var(--muted);font-size:11px;font-weight:600;cursor:pointer;transition:all .15s;white-space:nowrap}
.var-fchip.on{background:color-mix(in srgb,var(--accent) 15%,transparent);border-color:var(--accent);color:var(--accent)}
.var-fchip.on.danger{background:color-mix(in srgb,var(--danger) 15%,transparent);border-color:var(--danger);color:var(--danger)}
/* Cards */
.var-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px;scroll-margin-top:10px;transition:border-color .2s,box-shadow .2s}
.var-card.alerted{border-color:color-mix(in srgb,var(--warn) 50%,transparent)}
.var-card.critical{border-color:color-mix(in srgb,var(--danger) 50%,transparent);box-shadow:0 0 0 1px color-mix(in srgb,var(--danger) 15%,transparent)}
.var-card-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:12px}
.var-card-name{font-family:'Syne',sans-serif;font-size:14px;font-weight:700}
/* Notification rail */
.var-rail-hd{padding:12px 14px 10px;border-bottom:1px solid var(--border);flex-shrink:0}
.var-rail-body{overflow-y:auto;flex:1;padding:8px}
.var-notif{border-radius:9px;padding:10px 12px;margin-bottom:7px;cursor:pointer;transition:all .18s;position:relative;border:1px solid transparent}
.var-notif.nout{background:color-mix(in srgb,var(--danger) 11%,transparent);border-color:color-mix(in srgb,var(--danger) 30%,transparent)}
.var-notif.nlow{background:color-mix(in srgb,var(--warn) 10%,transparent);border-color:color-mix(in srgb,var(--warn) 28%,transparent)}
.var-notif:hover{filter:brightness(1.12)}
.var-notif.gone{opacity:0;height:0;margin:0;padding:0;overflow:hidden;pointer-events:none;transition:all .22s}
.var-notif-x{position:absolute;top:7px;right:8px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:12px;line-height:1;padding:1px 4px;border-radius:4px;opacity:.5}
.var-notif-x:hover{opacity:1;background:var(--surface2)}
/* Grid/chip kept from before */
.var-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px}
.var-chip{border-radius:9px;padding:10px 12px;font-size:12px;border:1.5px solid transparent;position:relative;overflow:hidden}
.var-chip-color{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:4px;border:1px solid rgba(255,255,255,.25);vertical-align:middle}
.var-chip-bar{height:3px;border-radius:99px;background:var(--border);margin-top:5px;overflow:hidden}
.var-chip-bar-fill{height:100%;border-radius:99px;transition:width .4s}
.var-chip-status{position:absolute;top:5px;right:6px;width:6px;height:6px;border-radius:50%}
.var-reorder-badge{display:inline-flex;align-items:center;gap:4px;font-size:10px;font-family:'DM Mono',monospace;background:var(--surface);border:1px solid var(--border);border-radius:5px;padding:2px 7px;margin-top:3px}
.var-summary{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.var-summary-item{font-size:11px;color:var(--muted)}
.var-summary-item span{color:var(--text);font-weight:600;font-family:'DM Mono',monospace}
/* Axis builder */
.var-axis{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:13px;margin-bottom:9px}
.var-axis-name-inp{background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 10px;font-family:'DM Sans',sans-serif;font-size:13px;flex:1;outline:none;transition:border-color .2s}
.var-axis-name-inp:focus{border-color:var(--accent)}
.var-axis-tag{display:inline-flex;align-items:center;gap:5px;background:var(--bg);border:1px solid var(--border);border-radius:99px;padding:3px 9px;font-size:12px;margin:2px}
.var-axis-tagx{background:none;border:none;color:var(--danger);cursor:pointer;font-size:13px;padding:0 2px;line-height:1}
.var-axis-valinp{background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 10px;font-family:'DM Sans',sans-serif;font-size:12px;flex:1;outline:none}
.var-axis-valinp:focus{border-color:var(--accent)}
.var-axis-colinp{width:34px;height:34px;border:1px solid var(--border);border-radius:6px;cursor:pointer;padding:2px;background:var(--bg);flex-shrink:0}
/* Matrix table */
.mx-th{background:var(--surface2);padding:7px 10px;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;font-weight:700;white-space:nowrap;border:1px solid var(--border)}
.mx-td{padding:5px 7px;border:1px solid var(--border);vertical-align:middle}
.mx-inp{width:58px;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;text-align:center;padding:3px 5px;outline:none}
.mx-inp:focus{border-color:var(--accent)}
.mx-barinp{width:105px;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;padding:3px 6px;outline:none}
.mx-barinp:focus{border-color:var(--accent)}
.mx-sku{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--surface);border-radius:4px;padding:1px 5px}
@keyframes slideIn{from{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.var-alert-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;animation:pulse 1.5s infinite}
.notif-bell-count{position:absolute;top:-5px;right:-7px;background:var(--danger);color:#fff;font-size:9px;font-weight:700;border-radius:99px;padding:1px 5px;min-width:16px;text-align:center;line-height:14px;animation:pulse 1.5s infinite}
.var-product-select{width:100%;padding:9px 13px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;margin-bottom:14px}
.var-attr-input{padding:8px 10px;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:12px;outline:none;width:100%}
.var-attr-input:focus{border-color:var(--accent)}

/* ===== PRODUCTION TAB ===== */
.prod-layout{display:grid;grid-template-columns:340px 1fr;gap:16px;align-items:start}
.prod-form-wrap{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px;position:sticky;top:80px}
.prod-list-wrap{display:flex;flex-direction:column;gap:14px}
.prod-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;margin-bottom:16px}
.prod-section{background:var(--surface2);border-radius:10px;padding:14px;margin-bottom:12px}
.prod-section-label{font-size:10px;color:var(--accent);text-transform:uppercase;letter-spacing:.6px;font-weight:700;margin-bottom:10px}
.prod-input{width:100%;padding:8px 11px;background:var(--bg);border:1px solid var(--border);border-radius:7px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:border-color .2s}
.prod-input:focus{border-color:var(--accent)}
.prod-row{display:grid;grid-template-columns:1.5fr 0.8fr 0.8fr 30px;gap:6px;margin-bottom:6px;align-items:center}
.prod-row-label{display:grid;grid-template-columns:1.5fr 0.8fr 0.8fr 30px;gap:6px;margin-bottom:4px}
.prod-row-label div{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.3px}
.prod-del{background:none;border:1px solid var(--border);border-radius:6px;color:var(--danger);cursor:pointer;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0;transition:background .15s}
.prod-del:hover{background:color-mix(in srgb,var(--danger) 15%,transparent)}
.prod-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px}
.prod-card-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px}
.prod-card-name{font-family:'Syne',sans-serif;font-size:15px;font-weight:700}
.prod-card-sub{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:2px}
.prod-cost-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
.prod-cost-box{background:var(--surface2);border-radius:9px;padding:12px;text-align:center}
.prod-cost-box-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px}
.prod-cost-box-val{font-family:'Syne',sans-serif;font-size:16px;font-weight:700}
.prod-materials-table{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:10px}
.prod-materials-table th{background:var(--surface2);padding:7px 10px;text-align:left;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;border-bottom:1px solid var(--border)}
.prod-materials-table td{padding:7px 10px;border-bottom:1px solid var(--border)}
.prod-margin-bar{height:6px;border-radius:99px;background:var(--border);overflow:hidden;margin-top:6px}
.prod-margin-bar-fill{height:100%;border-radius:99px;transition:width .5s}
.prod-batch-tag{display:inline-flex;align-items:center;gap:5px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:3px 9px;font-size:11px;font-family:'DM Mono',monospace}

/* ===== ITERATION TAB ===== */
.iter-layout{display:grid;grid-template-columns:1fr 380px;gap:16px;align-items:start}
.iter-form-wrap{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:22px}
.iter-log-wrap{display:flex;flex-direction:column;gap:12px}
.iter-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;margin-bottom:16px}
.iter-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;overflow:hidden}
.iter-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
.iter-card.saving::before{background:var(--accent)}
.iter-card.testing::before{background:var(--warn)}
.iter-card.success::before{background:var(--green)}
.iter-card.failed::before{background:var(--danger)}
.iter-card-title{font-weight:600;font-size:13px;margin-bottom:5px}
.iter-card-meta{font-size:11px;color:var(--muted);margin-bottom:10px;display:flex;gap:10px;flex-wrap:wrap}
.iter-tag{display:inline-block;padding:2px 8px;border-radius:99px;font-size:10px;font-weight:600}
.iter-tag-saving{background:color-mix(in srgb,var(--accent) 15%,transparent);color:var(--accent)}
.iter-tag-testing{background:color-mix(in srgb,var(--warn) 15%,transparent);color:var(--warn)}
.iter-tag-success{background:color-mix(in srgb,var(--green) 15%,transparent);color:var(--green)}
.iter-tag-failed{background:color-mix(in srgb,var(--danger) 15%,transparent);color:var(--danger)}
.iter-impact{display:flex;align-items:center;gap:8px;background:var(--surface2);border-radius:8px;padding:9px 12px;margin-bottom:8px;font-size:12px}
.iter-saving-amt{font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:var(--accent)}
.iter-timeline{position:relative;padding-left:22px}
.iter-timeline::before{content:'';position:absolute;left:7px;top:0;bottom:0;width:1px;background:var(--border)}
.iter-tl-dot{position:absolute;left:0;width:15px;height:15px;border-radius:50%;border:2px solid var(--border);background:var(--surface)}
.iter-tl-item{position:relative;margin-bottom:16px;padding-bottom:16px}
.iter-tl-item:last-child{margin-bottom:0;padding-bottom:0}
.iter-compare{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}
.iter-compare-box{background:var(--surface2);border-radius:8px;padding:10px;font-size:12px}
.iter-compare-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.3px;margin-bottom:4px}
.iter-compare-val{font-family:'DM Mono',monospace;font-size:14px;font-weight:600}
.var-summary{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.var-summary-item{font-size:11px;color:var(--muted)}
.var-summary-item span{color:var(--text);font-weight:600;font-family:'DM Mono',monospace}

/* ===== VARIANT AXIS BUILDER ===== */
.var-axis{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:10px}
.var-axis-header{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.var-axis-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;font-weight:700;flex:1}
.var-axis-name-input{background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 10px;font-family:'DM Sans',sans-serif;font-size:13px;flex:1;outline:none;transition:border-color .2s}
.var-axis-name-input:focus{border-color:var(--accent)}
.var-axis-values{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}
.var-axis-tag{display:inline-flex;align-items:center;gap:5px;background:var(--bg);border:1px solid var(--border);border-radius:99px;padding:4px 10px;font-size:12px;cursor:default}
.var-axis-tag-del{background:none;border:none;color:var(--danger);cursor:pointer;font-size:13px;line-height:1;padding:0 2px}
.var-axis-add-wrap{display:flex;gap:6px}
.var-axis-value-input{background:var(--bg);border:1px solid var(--border);border-radius:6px;color:var(--text);padding:5px 10px;font-family:'DM Sans',sans-serif;font-size:12px;flex:1;outline:none}
.var-axis-value-input:focus{border-color:var(--accent)}
.var-axis-color-input{width:36px;height:36px;border:1px solid var(--border);border-radius:6px;cursor:pointer;padding:2px;background:var(--bg)}

/* ===== MATRIX TABLE ===== */
.matrix-th{background:var(--surface2);padding:8px 12px;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;font-weight:700;white-space:nowrap;border:1px solid var(--border)}
.matrix-th.combo-col{color:var(--text);font-weight:600;text-transform:none;font-size:12px}
.matrix-td{padding:6px 8px;border:1px solid var(--border);vertical-align:middle}
.matrix-input{width:60px;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Mono',monospace;font-size:12px;text-align:center;padding:4px 6px;outline:none}
.matrix-input:focus{border-color:var(--accent)}
.matrix-input.warn-input{border-color:var(--warn)}
.matrix-barcode-input{width:110px;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text);font-family:'DM Mono',monospace;font-size:11px;padding:4px 6px;outline:none}
.matrix-barcode-input:focus{border-color:var(--accent)}
.matrix-combo-label{display:flex;align-items:center;gap:6px;white-space:nowrap;font-size:12px}
.matrix-color-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;border:1px solid rgba(255,255,255,.15)}
.matrix-sku-badge{font-family:'DM Mono',monospace;font-size:10px;color:var(--muted);background:var(--surface);border-radius:4px;padding:1px 5px;margin-left:4px}
</style>
</head>
<body>

<div class="topbar">
  <div style="display:flex;align-items:center;gap:6px">
    <div class="logo">Stock<span>Flow</span><span class="logo-badge">üìä Google Sheets</span></div>
  </div>
  <div class="tabs">
    <button class="tab active" onclick="switchTab('inventory',this)">üì¶ Inventory</button>
    <button class="tab" onclick="switchTab('addstock',this)">üì• Add Stock</button>
    <button class="tab" onclick="switchTab('deductstock',this)">üì§ Deduct Stock</button>
    <button class="tab" onclick="switchTab('monitor',this)">üîÑ Stock Monitor</button>
    <button class="tab" onclick="switchTab('variants',this)">üé® Variants</button>
    <button class="tab" onclick="switchTab('charts',this)">üìä Charts</button>
    <button class="tab" onclick="switchTab('suppliers',this)">üè¢ Suppliers</button>
    <button class="tab" onclick="switchTab('mva',this)">üè≠ MVA</button>
    <button class="tab" onclick="switchTab('production',this)">‚öôÔ∏è Production</button>
    <button class="tab" onclick="switchTab('iteration',this)">üîÅ Iteration</button>
    <button class="tab" onclick="switchTab('alerts',this)">‚ö† Alerts <span id="alert-count" style="background:var(--danger);color:#fff;border-radius:99px;padding:1px 6px;font-size:10px;margin-left:2px;vertical-align:middle"></span></button>
    <button class="tab" onclick="switchTab('gst',this)">üßæ GST Bill</button>
  </div>
  <div class="topbar-right">
    <button class="btn btn-ghost btn-sm" onclick="showSheetsSetup()">‚öôÔ∏è Sheet Setup</button>
    <button class="btn btn-ghost btn-sm" onclick="openImportExport()">‚¨Ü Import/Export</button>
    <button class="btn btn-ghost btn-sm" id="sync-btn" onclick="syncAll()" disabled>üîÑ Sync Now</button>
    <button class="btn btn-primary btn-sm" onclick="openModal()">+ Add Item</button>
  </div>
</div>

<div class="sync-bar">
  <div class="sync-dot" id="sync-dot"></div>
  <span class="sync-text" id="sync-text">Not connected ‚Äî paste your Google Apps Script URL to connect</span>
  <div class="sync-actions">
    <span id="last-sync-text" style="color:var(--muted);font-size:11px"></span>
  </div>
</div>

<div class="main">
  <div class="setup-banner" id="setup-banner">
    <h2>üîå Connect to <span>Google Sheets</span></h2>
    <p>Your inventory and supplier data will be stored securely in a Google Sheet ‚Äî shareable with your team, editable directly in Sheets, and synced in real-time. Takes about 5 minutes to set up.</p>
    <div class="setup-steps">
      <div class="setup-step">
        <div class="setup-step-num">1</div>
        <div class="setup-step-title">Create Google Sheet</div>
        <div class="setup-step-desc">Go to <strong>sheets.google.com</strong> ‚Üí New blank sheet ‚Üí Name it "StockFlow Database"</div>
      </div>
      <div class="setup-step">
        <div class="setup-step-num">2</div>
        <div class="setup-step-title">Add Apps Script</div>
        <div class="setup-step-desc">In your Sheet: <strong>Extensions ‚Üí Apps Script</strong> ‚Üí paste the script ‚Üí Deploy as Web App</div>
      </div>
      <div class="setup-step">
        <div class="setup-step-num">3</div>
        <div class="setup-step-title">Paste URL here</div>
        <div class="setup-step-desc">Copy the deployment URL and paste it below ‚Äî your data syncs automatically!</div>
      </div>
    </div>
    <div class="setup-input-row">
      <input class="setup-input" id="sheet-url-input" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" />
      <button class="btn btn-green" onclick="connectSheet()">üîå Connect Sheet</button>
      <button class="btn btn-ghost" onclick="showSheetsSetup()">üìã View Setup Guide</button>
    </div>
  </div>

  <div class="stats" id="stats-row"></div>

  <div id="tab-inventory">
    <div class="toolbar">
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="text" id="search" placeholder="Search name, SKU, barcode..." oninput="renderTable()">
      </div>
      <select id="filter-cat" onchange="renderTable()">
        <option value="">All Categories</option>
        <option>Retail</option><option>Warehouse</option><option>Manufacturing</option>
      </select>
      <select id="filter-status" onchange="renderTable()">
        <option value="">All Status</option>
        <option value="ok">In Stock</option>
        <option value="low">Low Stock</option>
        <option value="out">Out of Stock</option>
      </select>
      <div class="toolbar-right">
        <button class="btn btn-ghost btn-sm" onclick="sortBy('name')">Name ‚Üï</button>
        <button class="btn btn-ghost btn-sm" onclick="sortBy('stock')">Stock ‚Üï</button>
        <button class="btn btn-ghost btn-sm" onclick="sortBy('price')">Price ‚Üï</button>
      </div>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr>
          <th>Item / SKU / Barcode</th><th>Category</th><th>Stock</th>
          <th>Price (‚Çπ)</th><th>Reorder</th><th>Location</th><th>Supplier</th><th>Status</th><th>Actions</th>
        </tr></thead>
        <tbody id="tbody"></tbody>
      </table>
      <div id="empty-state" class="empty hidden"><div class="empty-icon">üì¶</div><div>No items found.</div></div>
      <div class="pager" id="pager"></div>
    </div>
  </div>

  <div id="tab-addstock" class="hidden">
    <div class="scan-tab-wrap">
      <div class="scan-hero" style="border-color:color-mix(in srgb,var(--green) 35%,transparent)">
        <div class="scan-hero-title" style="color:var(--green)">üì• Add Stock via Barcode</div>
        <p style="color:var(--muted);font-size:13px;margin-bottom:18px">Scan or type a product barcode. Stock will be added to inventory automatically.</p>
        <div class="scan-input-row">
          <div style="flex:1;display:flex;flex-direction:column;gap:4px">
            <label style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">Barcode (Scan or Type)</label>
            <div style="display:flex;gap:7px">
              <input class="scan-barcode-input add-mode" id="add-barcode-input" placeholder="Scan barcode here..." autocomplete="off"
                onkeydown="if(event.key==='Enter')processBarcodeScan('add')">
              <button class="btn btn-ghost btn-sm scan-cam-btn" onclick="toggleScanCamera('add')">üì∑ Camera</button>
            </div>
          </div>
          <div class="qty-input-wrap">
            <label>Quantity</label>
            <input class="qty-input" id="add-qty-input" type="number" min="1" value="1">
          </div>
          <button class="btn btn-green" onclick="processBarcodeScan('add')" style="height:46px;align-self:flex-end">‚ûï Add</button>
        </div>
        <div id="add-cam-reader" class="reader-scan"></div>
        <div class="not-found-card" id="add-not-found">
          <div style="font-size:28px;margin-bottom:6px">üîç</div>
          <div style="font-weight:600;margin-bottom:3px">Barcode not found in inventory</div>
          <div style="color:var(--muted);font-size:12px;margin-bottom:12px" id="add-not-found-code"></div>
          <button class="btn btn-primary btn-sm" onclick="openModalWithBarcode()">‚ûï Register as New Item</button>
        </div>
        <div class="scan-result-card add-result" id="add-result-card">
          <div class="scan-result-name" id="add-result-name"></div>
          <div class="scan-result-sku" id="add-result-sku"></div>
          <div class="scan-stock-change">
            <div class="scan-stock-box"><div class="lbl">Before</div><div class="val" id="add-before" style="color:var(--muted)"></div></div>
            <div class="scan-arrow">‚Üí</div>
            <div class="scan-stock-box"><div class="lbl">Added</div><div class="val" style="color:var(--green)" id="add-delta"></div></div>
            <div class="scan-arrow">‚Üí</div>
            <div class="scan-stock-box"><div class="lbl">New Stock</div><div class="val" style="color:var(--green)" id="add-after"></div></div>
          </div>
        </div>
      </div>
      <div class="scan-history" id="add-history-wrap">
        <div class="scan-history-title">üìã Recent Add Transactions</div>
        <div id="add-history-list"><div style="color:var(--muted);font-size:13px">No transactions yet this session.</div></div>
      </div>
    </div>
  </div>

  <div id="tab-deductstock" class="hidden">
    <div class="scan-tab-wrap">
      <div class="scan-hero" style="border-color:color-mix(in srgb,var(--danger) 35%,transparent)">
        <div class="scan-hero-title" style="color:var(--danger)">üì§ Deduct Stock / Sell via Barcode</div>
        <p style="color:var(--muted);font-size:13px;margin-bottom:18px">Scan or type a product barcode when selling or using stock. Inventory reduces automatically.</p>
        <div class="scan-input-row">
          <div style="flex:1;display:flex;flex-direction:column;gap:4px">
            <label style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px">Barcode (Scan or Type)</label>
            <div style="display:flex;gap:7px">
              <input class="scan-barcode-input deduct-mode" id="deduct-barcode-input" placeholder="Scan barcode here..." autocomplete="off"
                onkeydown="if(event.key==='Enter')processBarcodeScan('deduct')">
              <button class="btn btn-ghost btn-sm scan-cam-btn" onclick="toggleScanCamera('deduct')" style="border-color:var(--danger)!important;color:var(--danger)!important">üì∑ Camera</button>
            </div>
          </div>
          <div class="qty-input-wrap">
            <label>Quantity</label>
            <input class="qty-input" id="deduct-qty-input" type="number" min="1" value="1">
          </div>
          <button class="btn" style="background:var(--danger);color:#fff;height:46px;align-self:flex-end" onclick="processBarcodeScan('deduct')">‚ûñ Deduct</button>
        </div>
        <div id="deduct-cam-reader" class="reader-scan"></div>
        <div class="not-found-card" id="deduct-not-found">
          <div style="font-size:28px;margin-bottom:6px">üîç</div>
          <div style="font-weight:600;margin-bottom:3px">Barcode not found in inventory</div>
          <div style="color:var(--muted);font-size:12px" id="deduct-not-found-code"></div>
        </div>
        <div class="scan-result-card deduct-result" id="deduct-result-card">
          <div class="scan-result-name" id="deduct-result-name"></div>
          <div class="scan-result-sku" id="deduct-result-sku"></div>
          <div class="scan-stock-change">
            <div class="scan-stock-box"><div class="lbl">Before</div><div class="val" id="deduct-before" style="color:var(--muted)"></div></div>
            <div class="scan-arrow">‚Üí</div>
            <div class="scan-stock-box"><div class="lbl">Deducted</div><div class="val" style="color:var(--danger)" id="deduct-delta"></div></div>
            <div class="scan-arrow">‚Üí</div>
            <div class="scan-stock-box"><div class="lbl">New Stock</div><div class="val" id="deduct-after"></div></div>
          </div>
        </div>
        <div id="deduct-warn" style="display:none;background:color-mix(in srgb,var(--warn) 10%,transparent);border:1px solid color-mix(in srgb,var(--warn) 40%,transparent);border-radius:9px;padding:12px 16px;margin-top:10px;font-size:13px;color:var(--warn)">
          ‚ö†Ô∏è <strong>Warning:</strong> <span id="deduct-warn-msg"></span>
        </div>
      </div>
      <div class="scan-history" id="deduct-history-wrap">
        <div class="scan-history-title">üìã Recent Deduct / Sale Transactions</div>
        <div id="deduct-history-list"><div style="color:var(--muted);font-size:13px">No transactions yet this session.</div></div>
      </div>
    </div>
  </div>

  <!-- STOCK MONITOR TAB -->
  <div id="tab-monitor" class="hidden">
    <div class="monitor-layout">
      <div class="monitor-flow">
        <div class="flow-title">üîÑ Live Stock Monitoring Algorithm <span class="pulse-ring" style="color:var(--accent);font-size:11px;margin-left:6px">‚óè LIVE</span></div>
        <div class="flow-canvas" id="flow-canvas">
          <svg class="flow-svg" id="flow-svg">
            <defs>
              <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
                <polygon points="0 0, 8 3, 0 6" fill="#2a3347"/>
              </marker>
            </defs>
          </svg>
        </div>
      </div>
      <div class="monitor-sidebar">
        <div class="mon-card">
          <div class="mon-card-title">üìä Algorithm Output ‚Äî Right Now</div>
          <div id="algo-output-list"></div>
        </div>
        <div class="mon-card">
          <div class="mon-card-title">üî¥ Out of Stock</div>
          <div id="mon-out-list"><div style="color:var(--muted);font-size:12px">None</div></div>
        </div>
        <div class="mon-card">
          <div class="mon-card-title">üü° Low Stock ‚Äî Reorder Now</div>
          <div id="mon-low-list"><div style="color:var(--muted);font-size:12px">All good!</div></div>
        </div>
        <div class="mon-card">
          <div class="mon-card-title">üü¢ Healthy Stock</div>
          <div id="mon-ok-list"><div style="color:var(--muted);font-size:12px">No items yet</div></div>
        </div>
        <div class="mon-card">
          <div class="mon-card-title">‚öôÔ∏è Algorithm Steps</div>
          <div class="algo-step"><div class="algo-num">1</div><div>Scan all inventory items</div></div>
          <div class="algo-step"><div class="algo-num">2</div><div>Check stock vs reorder point</div></div>
          <div class="algo-step"><div class="algo-num">3</div><div>If stock = 0 ‚Üí flag OUT</div></div>
          <div class="algo-step"><div class="algo-num">4</div><div>If stock ‚â§ reorder ‚Üí flag LOW</div></div>
          <div class="algo-step"><div class="algo-num">5</div><div>If stock > reorder ‚Üí flag OK</div></div>
          <div class="algo-step"><div class="algo-num">6</div><div>Calculate suggested reorder qty</div></div>
          <div class="algo-step"><div class="algo-num">7</div><div>Auto-alert &amp; sync to sheet</div></div>
        </div>
        <button class="btn btn-primary" style="width:100%;margin-top:4px" onclick="runMonitorAlgo()">‚ñ∂ Run Algorithm Now</button>
      </div>
    </div>
  </div>

  <!-- VARIANTS TAB ‚Äî 3-panel: sidebar index | main cards | notif rail -->
  <div id="tab-variants" class="hidden" style="padding:0;overflow:hidden">

    <!-- Scrim behind drawer -->
    <div class="var-scrim" id="var-scrim" onclick="closeVarDrawer()"></div>

    <!-- Slide-out form drawer -->
    <div class="var-drawer" id="var-drawer">
      <div class="var-drawer-hd">
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700" id="var-drawer-title">Add Variants</div>
          <div style="font-size:11px;color:var(--muted);margin-top:1px">Define attributes ‚Üí auto-generate all combinations</div>
        </div>
        <button onclick="closeVarDrawer()" style="background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--muted);cursor:pointer;padding:5px 11px;font-size:14px">‚úï</button>
      </div>
      <div class="var-drawer-bd" id="var-drawer-body">
        <div style="margin-bottom:13px">
          <div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Parent Product</div>
          <select class="var-product-select" id="var-product-sel"></select>
        </div>
        <div style="background:var(--surface2);border-radius:9px;padding:11px;margin-bottom:13px">
          <div style="font-size:10px;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px">‚ö° Quick Presets</div>
          <div style="display:flex;gap:5px;flex-wrap:wrap">
            <button class="btn btn-ghost btn-sm" onclick="applyPreset('bandana')" style="font-size:11px">üêï Bandana</button>
            <button class="btn btn-ghost btn-sm" onclick="applyPreset('tshirt')" style="font-size:11px">üëï T-Shirt</button>
            <button class="btn btn-ghost btn-sm" onclick="applyPreset('shoes')" style="font-size:11px">üëü Shoes</button>
            <button class="btn btn-ghost btn-sm" onclick="applyPreset('colorsonly')" style="font-size:11px">üåà Colors</button>
            <button class="btn btn-ghost btn-sm" onclick="applyPreset('sizesonly')" style="font-size:11px">üìê Sizes</button>
          </div>
        </div>
        <div id="var-axes-container"></div>
        <button class="btn btn-ghost btn-sm" onclick="addVarAxis()" style="width:100%;margin-bottom:13px;border-style:dashed;font-size:12px">+ Add Attribute (Color, Size, Material‚Ä¶)</button>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:13px">
          <div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;margin-bottom:4px">Default Stock</div><input class="var-attr-input" id="var-default-stock" type="number" min="0" value="0"></div>
          <div><div style="font-size:10px;color:var(--warn);text-transform:uppercase;margin-bottom:4px">Default Min ‚ö†</div><input class="var-attr-input" id="var-default-reorder" type="number" min="0" value="5" style="border-color:var(--warn)"></div>
          <div><div style="font-size:10px;color:var(--blue);text-transform:uppercase;margin-bottom:4px">Default Cost ‚Çπ</div><input class="var-attr-input" id="var-default-cost" type="number" min="0" step="0.01" value="0" style="border-color:var(--blue)"></div>
          <div><div style="font-size:10px;color:var(--accent);text-transform:uppercase;margin-bottom:4px">Default Sell ‚Çπ</div><input class="var-attr-input" id="var-default-price" type="number" min="0" step="0.01" value="0"></div>
        </div>
        <!-- Matrix editor lives here after Generate -->
        <div id="var-matrix-editor" style="display:none">
          <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:3px" id="matrix-editor-title"></div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:11px" id="matrix-editor-sub"></div>
          <div style="overflow-x:auto;border:1px solid var(--border);border-radius:8px">
            <table id="matrix-table" style="border-collapse:collapse;font-size:11px;min-width:100%"></table>
          </div>
        </div>
      </div>
      <div class="var-drawer-ft">
        <button class="btn btn-ghost" onclick="generateMatrix()" style="flex:1;font-size:12px">‚ö° Generate</button>
        <button class="btn btn-primary" onclick="saveVariants()" style="flex:2">üíæ Save</button>
        <button class="btn btn-ghost" onclick="clearVarForm()" style="font-size:12px">‚Ü∫</button>
      </div>
    </div>

    <!-- 3-panel body -->
    <div class="var-page">

      <!-- LEFT: Product jump list -->
      <div class="var-sidebar">
        <div class="var-sb-hd">
          <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;margin-bottom:8px">üóÇ Products</div>
          <button class="btn btn-primary btn-sm" style="width:100%" onclick="openVarDrawer()">+ Add / Edit Variants</button>
        </div>
        <div class="var-sb-body" id="var-index-list">
          <div style="color:var(--muted);font-size:12px;padding:20px 8px;text-align:center">No products yet</div>
        </div>
      </div>

      <!-- CENTRE: Cards with search/filter -->
      <div class="var-main">
        <div class="var-topbar">
          <input class="var-search" id="var-search" placeholder="üîç  Search product or SKU‚Ä¶" oninput="renderVarCards()">
          <button class="var-fchip on" id="vf-all" onclick="setVarFilter('all',this)">All</button>
          <button class="var-fchip" id="vf-alerts" onclick="setVarFilter('alerts',this)">‚ö† Low</button>
          <button class="var-fchip danger" id="vf-out" onclick="setVarFilter('out',this)">üî¥ Out</button>
        </div>
        <div id="var-cards-container">
          <div style="color:var(--muted);font-size:13px;text-align:center;padding:70px 20px">
            <div style="font-size:40px;margin-bottom:10px">üé®</div>
            No variant products yet.<br>Click <strong style="color:var(--accent)">+ Add / Edit Variants</strong> to get started.
          </div>
        </div>
      </div>

      <!-- RIGHT: Notification rail -->
      <div class="var-notif-rail">
        <div class="var-rail-hd">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700">üîî Alerts</div>
            <button onclick="clearDismissedNotifs()" title="Restore dismissed" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:18px;line-height:1;padding:0">‚Ü∫</button>
          </div>
          <div style="font-size:11px;color:var(--muted);margin-top:3px" id="rail-subtitle">‚Äî</div>
          <!-- Summary pills -->
          <div style="display:flex;gap:5px;margin-top:8px" id="rail-pills"></div>
        </div>
        <div class="var-rail-body" id="var-notif-rail"></div>
      </div>
    </div>
  </div>

  <div id="tab-charts" class="hidden">
    <div class="cards-grid" style="grid-template-columns:2fr 1fr">
      <div class="card"><div class="card-title">üìà Stock Levels by Item</div><div class="chart-wrap"><canvas id="chart-stock"></canvas></div></div>
      <div class="card"><div class="card-title">ü•ß Value by Segment</div><div class="chart-wrap"><canvas id="chart-pie"></canvas></div></div>
      <div class="card" style="grid-column:1/-1"><div class="card-title">üí∞ Top Items by Value</div><div class="chart-wrap" style="height:230px"><canvas id="chart-value"></canvas></div></div>
    </div>
  </div>

  <div id="tab-suppliers" class="hidden">
    <div class="section-head">
      <div class="section-title">Supplier Tracker</div>
      <button class="btn btn-primary btn-sm" onclick="openSupplierModal()">+ Add Supplier</button>
    </div>
    <div class="table-wrap">
      <table class="sup-table">
        <thead><tr><th>Supplier</th><th>Contact</th><th>Email</th><th>Phone</th><th>GSTIN</th><th>Items</th><th>Last Order</th><th>Actions</th></tr></thead>
        <tbody id="sup-tbody"></tbody>
      </table>
      <div id="sup-empty" class="empty hidden"><div class="empty-icon">üè¢</div><div>No suppliers yet. Add one!</div></div>
    </div>
  </div>

  <div id="tab-mva" class="hidden">
    <div class="section-head"><div class="section-title">Manufacturing Value Added Dashboard</div></div>
    <div class="cards-grid" id="mva-content"></div>
  </div>

  <!-- ========== PRODUCTION TAB ========== -->
  <div id="tab-production" class="hidden">
    <div class="prod-layout">

      <!-- LEFT: Form -->
      <div class="prod-form-wrap">
        <div class="prod-title">‚öôÔ∏è Define Production Recipe</div>

        <div class="prod-section">
          <div class="prod-section-label">üì¶ Finished Product</div>
          <select class="prod-input" id="prod-item-sel" style="margin-bottom:9px">
            <option value="">‚Äî Select finished product ‚Äî</option>
          </select>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div>
              <div style="font-size:10px;color:var(--muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:.3px">Batch Size (units)</div>
              <input class="prod-input" id="prod-batch" type="number" min="1" value="10" placeholder="e.g. 10">
            </div>
            <div>
              <div style="font-size:10px;color:var(--muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:.3px">Selling Price (‚Çπ)</div>
              <input class="prod-input" id="prod-sell-price" type="number" step="0.01" placeholder="auto from item">
            </div>
          </div>
        </div>

        <!-- Raw Materials -->
        <div class="prod-section">
          <div class="prod-section-label" style="display:flex;justify-content:space-between;align-items:center">
            <span>üß™ Raw Materials</span>
            <button class="btn btn-ghost btn-sm" onclick="addRawRow()" style="font-size:11px;padding:3px 9px">+ Add</button>
          </div>
          <div class="prod-row-label"><div>Material</div><div>Qty</div><div>Cost/Unit ‚Çπ</div><div></div></div>
          <div id="raw-rows-container"></div>
        </div>

        <!-- Labor -->
        <div class="prod-section">
          <div class="prod-section-label" style="display:flex;justify-content:space-between;align-items:center">
            <span>üë∑ Labour Cost</span>
            <button class="btn btn-ghost btn-sm" onclick="addLaborRow()" style="font-size:11px;padding:3px 9px">+ Add</button>
          </div>
          <div class="prod-row-label"><div>Role / Task</div><div>Hours</div><div>Rate ‚Çπ/hr</div><div></div></div>
          <div id="labor-rows-container"></div>
        </div>

        <!-- Overhead: electricity, time, misc -->
        <div class="prod-section">
          <div class="prod-section-label" style="display:flex;justify-content:space-between;align-items:center">
            <span>‚ö° Overhead Costs</span>
            <button class="btn btn-ghost btn-sm" onclick="addOverheadRow()" style="font-size:11px;padding:3px 9px">+ Add</button>
          </div>
          <div class="prod-row-label"><div>Item</div><div>Units</div><div>Cost/Unit ‚Çπ</div><div></div></div>
          <div id="overhead-rows-container"></div>
          <div style="margin-top:9px;padding-top:9px;border-top:1px solid var(--border)">
            <div style="font-size:10px;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:.3px">‚è± Production Time</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:7px">
              <div>
                <div style="font-size:10px;color:var(--muted);margin-bottom:3px">Hours per batch</div>
                <input class="prod-input" id="prod-time-hrs" type="number" min="0" step="0.5" value="2" placeholder="hrs">
              </div>
              <div>
                <div style="font-size:10px;color:var(--muted);margin-bottom:3px">Electricity (‚Çπ/batch)</div>
                <input class="prod-input" id="prod-electricity" type="number" min="0" step="0.5" value="0" placeholder="‚Çπ">
              </div>
            </div>
          </div>
        </div>

        <button class="btn btn-primary" style="width:100%;margin-bottom:8px" onclick="saveRecipe()">üíæ Save Recipe & Calculate</button>
        <button class="btn btn-ghost" style="width:100%;font-size:12px" onclick="clearProdForm()">Clear Form</button>
      </div>

      <!-- RIGHT: Recipes list -->
      <div class="prod-list-wrap" id="prod-cards-container">
        <div style="color:var(--muted);font-size:13px;text-align:center;padding:60px 20px">
          <div style="font-size:32px;margin-bottom:10px">‚öôÔ∏è</div>
          No recipes yet. Select a product and fill in the costs.
        </div>
      </div>
    </div>
  </div>

  <!-- ========== ITERATION TAB ========== -->
  <div id="tab-iteration" class="hidden">
    <div class="iter-layout">

      <!-- LEFT: Log new iteration -->
      <div class="iter-form-wrap">
        <div class="iter-title">üîÅ Log Cost Improvement Cycle</div>
        <div style="margin-bottom:11px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Product</div>
          <select class="prod-input" id="iter-product-sel"><option value="">‚Äî Select product ‚Äî</option></select>
        </div>
        <div style="margin-bottom:11px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Improvement Title</div>
          <input class="prod-input" id="iter-title" placeholder="e.g. Switch to cheaper wax supplier">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:11px">
          <div>
            <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Category</div>
            <select class="prod-input" id="iter-cat">
              <option value="material">Raw Material</option>
              <option value="labor">Labour</option>
              <option value="overhead">Overhead / Electricity</option>
              <option value="process">Process / Time</option>
              <option value="supplier">Supplier Change</option>
              <option value="design">Design / Formula</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div>
            <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Status</div>
            <select class="prod-input" id="iter-status">
              <option value="testing">üß™ Testing</option>
              <option value="saving">üí° Idea / Planning</option>
              <option value="success">‚úÖ Implemented</option>
              <option value="failed">‚ùå Failed / Rejected</option>
            </select>
          </div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:11px">
          <div>
            <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Cost Before (‚Çπ/batch)</div>
            <input class="prod-input" id="iter-cost-before" type="number" step="0.01" placeholder="e.g. 250">
          </div>
          <div>
            <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Cost After (‚Çπ/batch)</div>
            <input class="prod-input" id="iter-cost-after" type="number" step="0.01" placeholder="e.g. 210">
          </div>
        </div>
        <div style="margin-bottom:11px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">What Changed</div>
          <textarea class="prod-input" id="iter-what" rows="2" placeholder="Describe what you changed and why..."></textarea>
        </div>
        <div style="margin-bottom:11px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Result / Observation</div>
          <textarea class="prod-input" id="iter-result" rows="2" placeholder="Quality impact, quantity impact, any issues..."></textarea>
        </div>
        <div style="margin-bottom:15px">
          <div style="font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.4px;margin-bottom:5px">Next Step / Action</div>
          <input class="prod-input" id="iter-next" placeholder="e.g. Order 50kg trial batch from new supplier">
        </div>
        <button class="btn btn-primary" style="width:100%;margin-bottom:8px" onclick="saveIteration()">üìù Log Iteration</button>
        <button class="btn btn-ghost" style="width:100%;font-size:12px" onclick="clearIterForm()">Clear</button>

        <!-- Summary panel -->
        <div style="margin-top:18px;background:var(--surface2);border-radius:10px;padding:16px">
          <div style="font-size:11px;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">üìä Improvement Summary</div>
          <div id="iter-summary-panel"><div style="color:var(--muted);font-size:12px">Log iterations to see savings</div></div>
        </div>
      </div>

      <!-- RIGHT: Timeline log -->
      <div class="iter-log-wrap">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
          <div style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700">Improvement Timeline</div>
          <div style="display:flex;gap:7px">
            <select class="prod-input" id="iter-filter-prod" onchange="renderIterations()" style="padding:5px 9px;font-size:12px;width:auto">
              <option value="">All Products</option>
            </select>
            <select class="prod-input" id="iter-filter-status" onchange="renderIterations()" style="padding:5px 9px;font-size:12px;width:auto">
              <option value="">All Status</option>
              <option value="testing">Testing</option>
              <option value="saving">Planning</option>
              <option value="success">Implemented</option>
              <option value="failed">Failed</option>
            </select>
          </div>
        </div>
        <div id="iter-timeline-container">
          <div style="color:var(--muted);font-size:13px;text-align:center;padding:60px 20px">
            <div style="font-size:32px;margin-bottom:10px">üîÅ</div>
            No iterations logged yet. Start tracking your cost improvements!
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="tab-alerts" class="hidden">
    <div style="display:flex;flex-direction:column;gap:14px">
      <div class="card" style="border-color:color-mix(in srgb,var(--warn) 30%,transparent)">
        <div class="card-title" style="color:var(--warn)">‚ö† Parent Stock Alerts</div>
        <div id="alerts-content"></div>
      </div>
      <div class="card" style="border-color:color-mix(in srgb,var(--danger) 30%,transparent)">
        <div class="card-title" style="color:var(--accent);display:flex;align-items:center;justify-content:space-between">
          <span>üé® Variant / Child Stock Alerts</span>
          <span id="var-alert-badge" style="background:var(--danger);color:#fff;border-radius:99px;padding:2px 10px;font-size:11px;font-weight:700;display:none">0</span>
        </div>
        <div id="var-alerts-content"><div style="color:var(--muted);font-size:13px">üéâ All variants well stocked!</div></div>
      </div>
    </div>
  </div>

  <div id="tab-gst" class="hidden">
    <div class="gst-layout">
      <div class="gst-builder">
        <div class="section-head" style="margin-bottom:14px">
          <div class="section-title">üßæ GST Invoice Builder</div>
          <div style="display:flex;gap:7px">
            <button class="btn btn-ghost btn-sm" onclick="clearBill()">üóë Clear</button>
            <button class="btn btn-primary btn-sm" onclick="printBill()">üñ® Print / PDF</button>
          </div>
        </div>
        <div class="gst-section">
          <div class="gst-section-title">Seller / Business Details</div>
          <div class="gst-form-row">
            <div><div class="gst-label">Business Name</div><input class="form-input" id="g-sell-name" value="Your Business Name" oninput="updateBill()"></div>
            <div><div class="gst-label">GSTIN</div><input class="form-input" id="g-sell-gstin" placeholder="22AAAAA0000A1Z5" oninput="updateBill()"></div>
          </div>
          <div class="gst-form-row one"><div><div class="gst-label">Address</div><input class="form-input" id="g-sell-addr" placeholder="Street, City, State ‚Äî PIN" oninput="updateBill()"></div></div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px">
            <div><div class="gst-label">Phone</div><input class="form-input" id="g-sell-phone" placeholder="+91..." oninput="updateBill()"></div>
            <div><div class="gst-label">Email</div><input class="form-input" id="g-sell-email" placeholder="you@email.com" oninput="updateBill()"></div>
            <div><div class="gst-label">State</div><input class="form-input" id="g-sell-state" placeholder="State" oninput="updateBill()"></div>
          </div>
        </div>
        <div class="gst-section">
          <div class="gst-section-title">Buyer Details</div>
          <div class="gst-form-row">
            <div><div class="gst-label">Buyer Name / Company</div><input class="form-input" id="g-buy-name" placeholder="Customer / Company" oninput="updateBill()"></div>
            <div><div class="gst-label">GSTIN (if registered)</div><input class="form-input" id="g-buy-gstin" placeholder="Optional" oninput="updateBill()"></div>
          </div>
          <div class="gst-form-row one"><div><div class="gst-label">Address</div><input class="form-input" id="g-buy-addr" placeholder="Buyer billing address" oninput="updateBill()"></div></div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px">
            <div><div class="gst-label">Phone</div><input class="form-input" id="g-buy-phone" placeholder="+91..." oninput="updateBill()"></div>
            <div><div class="gst-label">State</div><input class="form-input" id="g-buy-state" placeholder="State" oninput="updateBill()"></div>
            <div><div class="gst-label">Place of Supply</div><input class="form-input" id="g-pos" placeholder="State code e.g. 09" oninput="updateBill()"></div>
          </div>
        </div>
        <div class="gst-section">
          <div class="gst-section-title">Invoice Details</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:9px;margin-bottom:9px">
            <div><div class="gst-label">Invoice No.</div><input class="form-input" id="g-inv-no" value="INV-2026-001" oninput="updateBill()"></div>
            <div><div class="gst-label">Invoice Date</div><input class="form-input" type="date" id="g-inv-date" oninput="updateBill()"></div>
            <div><div class="gst-label">Due Date</div><input class="form-input" type="date" id="g-due-date" oninput="updateBill()"></div>
          </div>
          <div class="gst-form-row">
            <div><div class="gst-label">Transaction Type</div>
              <select class="form-input" id="g-txn-type" onchange="updateBill()"><option value="intra">Intra-State (CGST + SGST)</option><option value="inter">Inter-State (IGST)</option></select>
            </div>
            <div><div class="gst-label">Payment Terms</div><input class="form-input" id="g-pay-terms" placeholder="e.g. Net 30 days" oninput="updateBill()"></div>
          </div>
        </div>
        <div class="gst-section">
          <div class="gst-section-title" style="display:flex;justify-content:space-between;align-items:center">
            <span>Line Items</span><button class="btn btn-primary btn-sm" onclick="addBillItem()">+ Row</button>
          </div>
          <div style="display:grid;grid-template-columns:2fr 1fr 1fr 1fr 32px;gap:5px;margin-bottom:5px">
            <div class="gst-label">Item / Description</div><div class="gst-label">Qty</div><div class="gst-label">Rate (‚Çπ)</div><div class="gst-label">GST %</div><div></div>
          </div>
          <div id="bill-items-container"></div>
          <div style="margin-top:9px">
            <div class="gst-label" style="margin-bottom:4px">Quick add from inventory:</div>
            <select class="form-input" id="inv-quick-add" onchange="quickAddItem(this)" style="width:100%"><option value="">‚Äî Pick an inventory item ‚Äî</option></select>
          </div>
        </div>
        <div class="gst-section">
          <div class="gst-section-title">Additional Info</div>
          <div class="gst-form-row">
            <div><div class="gst-label">Bank / UPI Details</div><input class="form-input" id="g-bank" placeholder="A/c or UPI ID" oninput="updateBill()"></div>
            <div><div class="gst-label">Discount (‚Çπ)</div><input class="form-input" id="g-discount" type="number" value="0" min="0" oninput="updateBill()"></div>
          </div>
          <div class="gst-form-row one"><div>
            <div class="gst-label">Notes / Terms</div>
            <textarea class="form-input" id="g-notes" rows="2" placeholder="Thank you for your business!" oninput="updateBill()"></textarea>
          </div></div>
        </div>
      </div>
      <div class="gst-preview-wrap">
        <div class="gst-preview" id="bill-preview"></div>
        <div style="display:flex;gap:8px;margin-top:11px" class="bill-actions">
          <button class="btn btn-primary" style="flex:1" onclick="printBill()">üñ® Print / Save PDF</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-title" id="modal-title">Add New Item</div>
    <div class="form-grid">
      <div class="form-group"><label>Item Name</label><input class="form-input" id="f-name" placeholder="Product name"></div>
      <div class="form-group"><label>SKU</label><input class="form-input" id="f-sku" placeholder="SKU-001"></div>
      <div class="form-group full">
        <label>Barcode (EAN/UPC)</label>
        <div style="display:flex;gap:7px">
          <input class="form-input" id="f-barcode" placeholder="Scan or enter barcode" style="flex:1">
          <button class="btn btn-ghost btn-sm" onclick="toggleScanner()" style="white-space:nowrap; border-color: var(--accent); color: var(--accent);">üì∑ Scan</button>
          <button class="btn btn-ghost btn-sm" onclick="document.getElementById('f-barcode').value='890'+Math.floor(Math.random()*10000000000).toString().padStart(10,'0')" style="white-space:nowrap">üîÄ Auto</button>
        </div>
        <div id="reader" style="width: 100%; margin-top: 10px; display: none; border-radius: 8px; overflow: hidden; border: 1px solid var(--border);"></div>
      </div>
      <div class="form-group"><label>Category</label>
        <select class="form-input" id="f-cat"><option>Retail</option><option>Warehouse</option><option>Manufacturing</option></select>
      </div>
      <div class="form-group"><label>Location / Shelf</label><input class="form-input" id="f-loc" placeholder="A3-Shelf2"></div>
      <div class="form-group"><label>Stock Qty</label><input class="form-input" id="f-stock" type="number" min="0" placeholder="0"></div>
      <div class="form-group"><label>Max Capacity</label><input class="form-input" id="f-max" type="number" min="1" placeholder="100"></div>
      <div class="form-group"><label>Reorder Point</label><input class="form-input" id="f-reorder" type="number" min="0" placeholder="10"></div>
      <div class="form-group"><label>Unit Price (‚Çπ)</label><input class="form-input" id="f-price" type="number" step="0.01" placeholder="0.00"></div>
      <div class="form-group"><label>HSN Code</label><input class="form-input" id="f-hsn" placeholder="e.g. 8481"></div>
      <div class="form-group"><label>GST Rate</label>
        <select class="form-input" id="f-gst"><option value="0">0%</option><option value="5">5%</option><option value="12">12%</option><option value="18" selected>18%</option><option value="28">28%</option></select>
      </div>
      <div class="form-group full"><label>Supplier</label><input class="form-input" id="f-supplier" placeholder="Supplier name"></div>
      <div class="form-group full"><label>Notes</label><input class="form-input" id="f-notes" placeholder="Optional notes"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveItem()">Save Item</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="sup-modal">
  <div class="modal">
    <div class="modal-title" id="sup-modal-title">Add Supplier</div>
    <div class="form-grid">
      <div class="form-group"><label>Supplier Name</label><input class="form-input" id="s-name" placeholder="Company name"></div>
      <div class="form-group"><label>Contact Person</label><input class="form-input" id="s-contact" placeholder="Name"></div>
      <div class="form-group"><label>Email</label><input class="form-input" id="s-email" type="email" placeholder="email@supplier.com"></div>
      <div class="form-group"><label>Phone</label><input class="form-input" id="s-phone" placeholder="+91 XXXXX XXXXX"></div>
      <div class="form-group"><label>GSTIN</label><input class="form-input" id="s-gstin" placeholder="22AAAAA0000A1Z5"></div>
      <div class="form-group"><label>Last Order Date</label><input class="form-input" id="s-lastorder" type="date"></div>
      <div class="form-group full"><label>Address</label><input class="form-input" id="s-addr" placeholder="Full address"></div>
      <div class="form-group full"><label>Notes (payment terms, lead time)</label><input class="form-input" id="s-notes" placeholder="e.g. Net 30, 7 day lead time"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeSupplierModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveSupplier()">Save Supplier</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="ie-modal">
  <div class="modal" style="width:430px">
    <div class="modal-title">Import / Export</div>
    <div style="display:flex;gap:8px;margin-bottom:13px">
      <button class="btn btn-ghost" style="flex:1" onclick="exportCSV()">‚¨á CSV</button>
      <button class="btn btn-ghost" style="flex:1" onclick="exportJSON()">‚¨á JSON</button>
    </div>
    <div class="import-area" onclick="document.getElementById('csv-file').click()">
      <div style="font-size:22px;margin-bottom:6px">üìÇ</div>
      <div style="color:var(--muted);font-size:12px">Click to import CSV<br><small>Columns: name, sku, barcode, category, stock, maxCapacity, reorderPoint, price, hsn, gstRate, location, supplier</small></div>
      <input type="file" id="csv-file" accept=".csv" onchange="importCSV(event)">
    </div>
    <div class="modal-actions"><button class="btn btn-ghost" onclick="closeIE()">Close</button></div>
  </div>
</div>

<div class="modal-overlay" id="sheets-modal">
  <div class="modal sheets-modal">
    <div class="modal-title">üìä Google Sheets Setup Guide</div>
    <div style="background:var(--surface2);border-radius:8px;padding:14px;margin-bottom:16px;font-size:13px;color:var(--muted)">
      Follow these steps once ‚Äî takes ~5 minutes. After setup, all your inventory data lives securely in a Google Sheet.
    </div>
    <div class="instruction-row"><span class="step-pill">1</span><div class="instruction-text"><strong>Create a new Google Sheet</strong><br>Go to <a href="https://sheets.google.com" target="_blank" style="color:var(--accent)">sheets.google.com</a> ‚Üí click <strong>"Blank"</strong> ‚Üí rename it to <kbd>StockFlow Database</kbd></div></div>
    <div class="instruction-row"><span class="step-pill">2</span><div class="instruction-text"><strong>Open Apps Script editor</strong><br>In your Sheet, click <strong>Extensions ‚Üí Apps Script</strong>. A new tab opens with a code editor.</div></div>
    <div class="instruction-row"><span class="step-pill">3</span><div class="instruction-text"><strong>Paste this script</strong> ‚Äî delete everything in the editor first, then paste:
        <div class="code-block">
<span class="cm">// StockFlow Google Sheets API (Full Sync)</span>
<span class="kw">function</span> doGet(e) {
  <span class="kw">if</span> (e.parameter.action === <span class="str">'ping'</span>) <span class="kw">return</span> ContentService.createTextOutput(JSON.stringify({ status: <span class="str">'ok'</span>, sheet: <span class="str">'StockFlow DB'</span> })).setMimeType(ContentService.MimeType.JSON);
  
  <span class="kw">const</span> ss = SpreadsheetApp.getActiveSpreadsheet();
  <span class="kw">const</span> response = {
    items: getSheetData(ss.getSheetByName(<span class="str">"Items"</span>)),
    suppliers: getSheetData(ss.getSheetByName(<span class="str">"Suppliers"</span>))
  };
  <span class="kw">return</span> ContentService.createTextOutput(JSON.stringify(response)).setMimeType(ContentService.MimeType.JSON);
}

<span class="kw">function</span> doPost(e) {
  <span class="kw">try</span> {
    <span class="kw">const</span> ss = SpreadsheetApp.getActiveSpreadsheet();
    <span class="kw">const</span> data = JSON.parse(e.postData.contents);
    
    <span class="kw">if</span> (data.items) writeSheetData(ss.getSheetByName(<span class="str">"Items"</span>), data.items, [<span class="str">"id"</span>,<span class="str">"name"</span>,<span class="str">"sku"</span>,<span class="str">"barcode"</span>,<span class="str">"category"</span>,<span class="str">"stock"</span>,<span class="str">"maxCapacity"</span>,<span class="str">"reorderPoint"</span>,<span class="str">"price"</span>,<span class="str">"hsn"</span>,<span class="str">"gstRate"</span>,<span class="str">"location"</span>,<span class="str">"supplier"</span>,<span class="str">"notes"</span>]);
    <span class="kw">if</span> (data.suppliers) writeSheetData(ss.getSheetByName(<span class="str">"Suppliers"</span>), data.suppliers, [<span class="str">"id"</span>,<span class="str">"name"</span>,<span class="str">"contact"</span>,<span class="str">"email"</span>,<span class="str">"phone"</span>,<span class="str">"gstin"</span>,<span class="str">"addr"</span>,<span class="str">"lastOrder"</span>,<span class="str">"notes"</span>]);
    
    <span class="kw">return</span> ContentService.createTextOutput(JSON.stringify({ status: <span class="str">"success"</span> })).setMimeType(ContentService.MimeType.JSON);
  } <span class="kw">catch</span>(err) {
    <span class="kw">return</span> ContentService.createTextOutput(JSON.stringify({ status: <span class="str">"error"</span>, msg: err.toString() })).setMimeType(ContentService.MimeType.JSON);
  }
}

<span class="kw">function</span> getSheetData(sheet) {
  <span class="kw">if</span> (!sheet) <span class="kw">return</span> [];
  <span class="kw">const</span> data = sheet.getDataRange().getValues();
  <span class="kw">if</span> (data.length < 2) <span class="kw">return</span> []; 
  <span class="kw">const</span> headers = data[0], result = [];
  <span class="kw">for</span> (<span class="kw">let</span> i = 1; i < data.length; i++) {
    <span class="kw">const</span> obj = {};
    <span class="kw">for</span> (<span class="kw">let</span> j = 0; j < headers.length; j++) obj[headers[j]] = data[i][j];
    result.push(obj);
  }
  <span class="kw">return</span> result;
}

<span class="kw">function</span> writeSheetData(sheet, data, headers) {
  <span class="kw">if</span> (!sheet) {
    <span class="kw">const</span> ss = SpreadsheetApp.getActiveSpreadsheet();
    sheet = ss.insertSheet(headers.includes(<span class="str">"sku"</span>) ? <span class="str">"Items"</span> : <span class="str">"Suppliers"</span>);
  }
  sheet.clearContents();
  sheet.appendRow(headers); 
  <span class="kw">if</span> (data.length === 0) <span class="kw">return</span>;
  <span class="kw">const</span> rows = data.map(item => headers.map(header => item[header] === undefined ? <span class="str">""</span> : item[header]));
  sheet.getRange(2, 1, rows.length, headers.length).setValues(rows);
}
        </div>
      </div>
    </div>
    <div class="instruction-row"><span class="step-pill">4</span><div class="instruction-text"><strong>Deploy as Web App</strong><br>Click <strong>Deploy ‚Üí New deployment</strong> ‚Üí Type: <kbd>Web app</kbd> ‚Üí Execute as: <kbd>Me</kbd> ‚Üí Who has access: <kbd>Anyone</kbd> ‚Üí click <strong>Deploy</strong> ‚Üí <strong>Authorize</strong> when prompted.</div></div>
    <div class="instruction-row"><span class="step-pill">5</span><div class="instruction-text"><strong>Copy the Web App URL</strong><br>After deploying, copy the URL and paste it below.</div></div>
    <div style="background:color-mix(in srgb,var(--warn) 8%,transparent);border:1px solid color-mix(in srgb,var(--warn) 25%,transparent);border-radius:8px;padding:13px;margin-top:14px;font-size:12px;color:var(--text)">‚ö†Ô∏è <strong>Important:</strong> When you re-deploy after changes, always click <strong>Deploy ‚Üí Manage deployments ‚Üí Edit (pencil) ‚Üí New version</strong>.</div>
    <div style="margin-top:16px">
      <div style="font-size:12px;color:var(--muted);margin-bottom:8px">Paste your Web App URL here:</div>
      <div style="display:flex;gap:8px">
        <input class="form-input" id="sheet-url-modal" placeholder="https://script.google.com/macros/s/.../exec" style="flex:1;font-family:'DM Mono',monospace;font-size:12px">
        <button class="btn btn-green" onclick="connectFromModal()">üîå Connect</button>
      </div>
    </div>
    <div class="modal-actions" style="margin-top:12px"><button class="btn btn-ghost" onclick="closeSheetsModal()">Close</button></div>
  </div>
</div>

<div class="loading-overlay" id="loading"><div class="spinner"></div><div style="color:var(--muted);font-size:13px" id="loading-text">Syncing with Google Sheets...</div></div>
<div class="toast" id="toast"><span id="toast-icon">‚úÖ</span><span id="toast-msg">Done!</span></div>

<script src="stockflow.js"></script>
</script>
</body>
</html>
